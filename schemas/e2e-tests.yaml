name: Workflow de Testes End-to-End

groups:
  on_group:
    label: Eventos
    description: Define os eventos que disparam os testes E2E
    fields:
      on:
        label: "Eventos"
        type: list
        itemType: string
        required: true
        help: "Eventos que acionam o workflow (ex: push, pull_request)"
      branches:
        label: "Branches"
        type: list
        itemType: string
        required: false
        help: "Branches nas quais o workflow deve rodar"

  jobs_group:
    label: Jobs
    description: Define os jobs de execução dos testes E2E
    repeatable: true
    fields:
      jobs:
        label: "Jobs"
        type: object
        required: true
        nameableKey: true
        fields:
          runs-on:
            label: "Sistema Operacional"
            type: string
            required: true
            help: "Sistema operacional do job (ex: ubuntu-latest)"
          steps:
            label: "Etapas"
            type: list
            itemType: object
            required: true
            help: "Etapas executadas no job"
            fields:
              name:
                label: "Nome da Etapa"
                type: string
                required: true
                help: "Nome da etapa"
              run:
                label: "Comando"
                type: string
                required: false
                help: "Comando executado na etapa (ex: npm run test:e2e)"
              uses:
                label: "Ação Reutilizável"
                type: string
                required: false
                help: "Ação reutilizável do GitHub (ex: actions/checkout@v3)"
              with:
                label: "Parâmetros"
                type: object
                required: false
                help: "Parâmetros para a ação reutilizável"

  reports_group:
    label: Relatórios
    description: Relatórios e artefatos de saída dos testes E2E
    fields:
      reports:
        label: "Relatórios"
        type: list
        itemType: string
        required: false
        help: "Caminhos ou formatos de relatórios gerados (ex: junit, allure)"
      artifacts:
        label: "Artefatos"
        type: list
        itemType: string
        required: false
        help: "Arquivos ou diretórios a serem salvos após os testes (ex: logs/, screenshots/, videos/)"

rules:
  required-job:
    description: O workflow deve conter ao menos um job
    condition: $count(groups.jobs_group.fields.jobs) > 0
    error: É necessário definir ao menos um job de testes E2E

  required-test-step:
    description: Cada job deve possuir ao menos uma etapa que rode os testes
    condition: >
      $exists(groups.jobs_group.fields.jobs.fields.steps.fields.run ~> /.*(cypress|playwright|e2e|test).*/i)
    error: Cada job precisa incluir uma etapa que execute testes E2E

  required-report:
    description: É recomendado que haja ao menos um relatório de testes
    condition: $count(groups.reports_group.fields.reports) > 0
    error: Nenhum relatório de teste foi definido
